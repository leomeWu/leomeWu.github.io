---
title: epoll
date: 2023-12-22 13:10:00 +0800
categories: [ustc, net-prog]
tags: [net]     # TAG names should always be lowercase
author: wyb
---

## 什么是IO多路复用
在日常生活中，这样的模型其实随处可见，想象这样一个场景：我们在海底捞吃火锅。尽管海底捞以热情的服务著称，但是他也不能做到给每一桌客人都配备一个服务员。服务员在几个桌子之间辗转腾挪，这就是一种多路复用。

回到网络编程的世界中，IO多路复用变成了这样子。

多路：存在多个需要被服务（监听事件）的socket fd

复用：复用一个thread 同时为多个 fd 提供处理服务

## 多路复用的实现
select

## epoll内核源码解读
linux-5.7-rc4/include/linux/eventpoll.h

linux-5.7-rc4/fs/eventpoll.c

### epoll模块初始化
~~~c
static int __init eventpoll_init(void)
{
...
	/* Allocates slab cache used to allocate "struct epitem" items */
	epi_cache = kmem_cache_create("eventpoll_epi", sizeof(struct epitem),
			0, SLAB_HWCACHE_ALIGN|SLAB_PANIC|SLAB_ACCOUNT, NULL);

	/* Allocates slab cache used to allocate "struct eppoll_entry" */
	pwq_cache = kmem_cache_create("eventpoll_pwq",
		sizeof(struct eppoll_entry), 0, SLAB_PANIC|SLAB_ACCOUNT, NULL);

	return 0;
}
fs_initcall(eventpoll_init);
~~~



